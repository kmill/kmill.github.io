<!doctype html>
<html>
<head>
<script type="text/javascript">
var rdata = [63.68810456,
 51.8168581,
 71.70695373,
 67.03718737,
 49.36665271,
 94.20715912,
 74.8329948,
 45.7342554,
 56.08706349,
 19.98,
 70.24330995,
 56.87769378,
 62.55195373,
 43.76863923,
 34.95144732,
 60.1918581,
 74.43466618,
 75.16747426,
 66.21946079,
 73.62778941,
 63.0579948,
 52.39633756,
 4.39,
 68.2812278,
 66.45758402,
 68.35966618,
 63.29258402,
 59.24654295,
 70.1479948,
 95.32267965,
 31.61946079,
 50.397283,
 40.47113217,
 65.60591265,
 37.47644732,
 75.7829948,
 78.58987157,
 86.78903588,
 63.43602241,
 69.70539211,
 19.24822845,
 67.36570726,
 56.73062576,
 78.61695373,
 78.51403588,
 52.94852081,
 84.5,
 58.92501943,
 49.76696902,
 46.40174353,
 48.70828646,
 70.26281777,
 81.425,
 83.21366653,
 45.32263217,
 54.18587578,
 74.01216348,
 27.02137233,
 52.83914029,
 45.25716535,
 79.98912636,
 39.93914029,
 63.13131915,
 72.8952006,
 92.75866653,
 66.26722878,
 71.27033432,
 61.10273222,
 82.01486617,
 67.74472633,
 55.16973124,
 44.20445155,
 48.82276139,
 35.24556539,
 65.03639463,
 46.55529061,
 60.02185186,
 37.3435431,
 62.44063587,
 71.34957556,
 54.30750847,
 59.01764341,
 72.86903202,
 40.79667923,
 50.47764832,
 48.51639954,
 58.36084017,
 90.4,
 78.12378788,
 70.19090909,
 96.25606061,
 55.06515152,
 62.67272727,
 43.71306818,
 86.09488636,
 83.37090909,
 58.38522727,
 64.40454545,
 66.48227273,
 71.72681818,
 69.05166667,
 57.22469697,
 73.91878788,
 80.58393939,
 73.75772727,
 66.10056818,
 74.67136364,
 64.42575758,
 43.32409091,
 78.26166667,
 71.16166667,
 96.75606061,
 60.45666667,
 68.19469697,
 74.06212121,
 62.89833333,
 43.26515152,
 65.26212121,
 51.90454545,
 57.0425,
 70.21515152,
 71.73363636,
 66.52272727,
 5.53,
 63.6480303,
 83.94,
 69.25378787878788,
 69.19128787878788,
 72.58766233766234,
 63.082454004329,
 49.49492694805194,
 49.709063852813856,
 94.5,
 60.64103084415584,
 68.46212121212122,
 78.5,
 81.0,
 59.24465638528138,
 61.814610389610394,
 46.01308170995671,
 54.79883658008658,
 44.15159386068477,
 65.43156114718614,
 69.3693722943723,
 57.338311688311684,
 84.5577922077922,
 78.60602002164502,
 65.5633658008658,
 63.52095508658009,
 82.16244588744588,
 23.23766233766234,
 64.30439664502165,
 95.0,
 36.563149350649354,
 71.44534632034632,
 74.57700216450216,
 64.44020562770562,
 86.5,
 75.98760822510823,
 86.71428571428571,
 43.553043831168836,
 52.77770562770563,
 80.37142857142857,
 95.0,
 61.1548895,
 56.7098895,
 48.40359116,
 45.38486188,
 64.65737569,
 80.45856354,
 75.65980663,
 74.28729282,
 63.71229282,
 39.99743094,
 48.02994475,
 55.11737569,
 28.41881215,
 73.66850829,
 62.17859116,
 62.14364641,
 88.6160221,
 61.93477901,
 84.89226519,
 72.19353591,
 72.56353591,
 61.64364641,
 64.68861878,
 42.91116022,
 61.60734807,
 86.45856354,
 35.75878453,
 97.94475138,
 79.18232044,
 55.24737569,
 42.05240331,
 77.66477901,
 75.67983425,
 71.28729282,
 50.13986188,
 85.6160221,
 17.42748619,
 85.54350829,
 81.58991713,
 65.98853591,
 43.35870166,
 79.59856354,
 88.1160221,
 75.12850829,
 54.46494475,
 80.78729282,
 42.84743094,
 50.15991713,
 68.2,
 65.64,
 42.51,
 80.63,
 72.5,
 36.75,
 67.56,
 60.24,
 45.3,
 53.11,
 83.43,
 30.27,
 43.31,
 75.11,
 89.65,
 71.43,
 50.42,
 60.43,
 58.74,
 52.38,
 59.0,
 46.92,
 68.0,
 73.68,
 58.27,
 67.6,
 63.17,
 75.43,
 91.34,
 35.91,
 84.05,
 86.2,
 85.48,
 87.15,
 84.05,
 90.93,
 61.35,
 80.43,
 83.52,
 67.09,
 74.01,
 50.71,
 70.52,
 43.65,
 70.36,
 68.72,
 64.825,
 60.105,
 38.945,
 40.09,
 77.58,
 67.115,
 65.535,
 49.49,
 64.29,
 86.715,
 47.595,
 59.52,
 70.27,
 83.22,
 59.395,
 66.04,
 75.265,
 75.61,
 80.595,
 85.805,
 77.86,
 83.07,
 71.295,
 74.35,
 66.5,
 67.355,
 75.45,
 61.465,
 62.54,
 70.575,
 36.58,
 64.125,
 45.78,
 63.275,
 89.8,
 73.86,
 55.495,
 72.815,
 50.56,
 78.685,
 53.19,
 20.49,
 62.055,
 57.36,
 71.32,
 83.81,
 80.295,
 94.775,
 49.05830904,
 75.73520408,
 78.12944606,
 45.73928571,
 62.08705539,
 81.70602041,
 76.94139942,
 82.39183673,
 77.4574344,
 68.86982507,
 93.76938776,
 79.11900875,
 62.77287172,
 81.28199708,
 67.19504373,
 37.38010204,
 55.99607872,
 69.18221574,
 77.76938776,
 49.31309038,
 72.83161808,
 60.71412536,
 60.98862974,
 52.46864431,
 52.43107872,
 62.74167638,
 55.1521137,
 85.1856414,
 53.44428571,
 81.67482507,
 68.35102041,
 84.57259475,
 82.19825073,
 80.98221574];

rdata.sort(function (a, b) {
  return a - b;
});

var kdens = [0.00028765752808485381,
 0.00034107938905715308,
 0.00039015131691569213,
 0.00043102421635540409,
 0.00046076059490868297,
 0.00047805830111863611,
 0.00048376096986635825,
 0.00048101148541052188,
 0.0004749736469554481,
 0.00047213841676340296,
 0.00047932130018867952,
 0.00050252543210135619,
 0.00054587768433789034,
 0.00061083876003560991,
 0.00069584603619864604,
 0.00079647693552072996,
 0.00090613036108245484,
 0.0010171270629225136,
 0.0011220441736290196,
 0.0012150451893761633,
 0.0012929625448929358,
 0.0013559429719078927,
 0.0014075659035686033,
 0.0014544645294015035,
 0.0015055807577484804,
 0.0015712376318638011,
 0.0016622033085519341,
 0.0017888626820387276,
 0.0019605389308515017,
 0.0021849541216767262,
 0.002467806936831502,
 0.0028124716450593115,
 0.0032198571905479698,
 0.0036884736310782086,
 0.0042147154838027426,
 0.0047932985014386368,
 0.0054177165676100869,
 0.0060805649753157337,
 0.0067736313237316105,
 0.0074877721556744188,
 0.0082127214783182002,
 0.0089370528997013057,
 0.0096484980983163535,
 0.010334714128106767,
 0.010984439045976893,
 0.011588847068208752,
 0.012142861167142435,
 0.012646209951205663,
 0.013104090890442991,
 0.013527369216032335,
 0.013932263244773683,
 0.014339444791583875,
 0.014772459736915171,
 0.015255405950808132,
 0.015809931291953235,
 0.016451824467323926,
 0.017187705532282646,
 0.01801248770365985,
 0.018908288869566425,
 0.019845273362350833,
 0.020784524254663473,
 0.021682575507815938,
 0.022496808021310225,
 0.023190669795348944,
 0.02373770459734308,
 0.024123669068967589,
 0.024346500121732482,
 0.024414416500285484,
 0.02434284294074093,
 0.02415101751821563,
 0.023859048518689668,
 0.023485881998267621,
 0.023048247285065281,
 0.022560308627814364,
 0.022033581014584587,
 0.021476712499503843,
 0.02089495804856039,
 0.020289469323292904,
 0.019656773384904336,
 0.018988905383008178,
 0.018274550546898357,
 0.017501269154346164,
 0.016658517221342012,
 0.015740857083734856,
 0.014750585432051936,
 0.013699054999753857,
 0.012606229023611588,
 0.011498420809066779,
 0.010404625172798622,
 0.0093522193304376982,
 0.0083629912998972409,
 0.0074503867022035486,
 0.0066185613614830469,
 0.0058633681625196591,
 0.0051749212094377725,
 0.0045410068723183731,
 0.0039504535137122876,
 0.0033956647385241265,
 0.00287382127203122,
 0.0023866591280742771,
 0.0019391089365550028];

var mean = 64.656154812594494;
var std = 16.414700450437145;

var cAp = 88;
var cA = 81;
var cAm = 76;
var cBp = 72;
var cB = 66
var cBm = 62;
var cCp = 57;
var cC = 48;
var cCm = 42;
var cDp = 39;
var cD = 33;
var cF = 0;

var gds = [
  ["cAp", "#53f", 0, 'A', 'A+'],
  ["cA", "#00f", 0, 'A', 'A'],
  ["cAm", "#37d", 1, 'A', 'A-'],
  ["cBp", "#0d7", 0, 'B', 'B+'],
  ["cB", "#0e0", 0, 'B', 'B'],
  ["cBm", "#3d0", 1, 'B', 'B-'],
  ["cCp", "#de0", 0, 'C', 'C+'],
  ["cC", "#ed0", 0, 'C', 'C'],
  ["cCm", "#fd0", 1, 'C', 'C-'],
  ["cDp", "#f00", 0, 'D', 'D+'],
  ["cD", "#e00", 1, 'D', 'D'],
  ["cF", "#999", 1, 'F', 'F'],
];

var hist = [];
for (var i = 0; i <= 100; i++) {
  hist[i] = 0;
}
for (var i = 0; i < rdata.length; i++) {
  var s = ~~rdata[i];
  hist[s]++;
}

function draw() {
  var canvas = document.getElementById("graph");
  var ctxt = canvas.getContext("2d");

  ctxt.fillStyle = "#eee";
  ctxt.fillStyle = "#fff";
  ctxt.fillRect(0, 0, canvas.width, canvas.height);

  ctxt.lineWidth = 1;

  ctxt.fillStyle = "#eee";
  ctxt.beginPath();
  ctxt.moveTo(5.5, 100.5-2.5);
  for (var i = 0; i <= 100; i++) {
    ctxt.lineTo(5.5 + 5*i, 100.5-2.5-kdens[i]*3000);
  }
  ctxt.lineTo(5.5 + 5*100, 100.5-2.5);
  ctxt.lineTo(5.5, 100.5-2.5);
  ctxt.fill();

  function scoreline(cutoff, tall) {
    ctxt.beginPath();
    ctxt.moveTo(5.5+5*cutoff-0, 100.5-2.5);
    ctxt.lineTo(5.5+5*cutoff-0, 5 + (tall === 1 ? 0 : 15));
    ctxt.stroke();
  }


  ctxt.strokeStyle = "#ccc";
  for (var i = 0; i < gds.length; i++) {
    scoreline(window[gds[i][0]], gds[i][2]);
  }

  ctxt.fillStyle = "#000";
  ctxt.strokeStyle = "#000";

  ctxt.beginPath();
  ctxt.moveTo(5.5,100.5);
  ctxt.lineTo(5.5+100*5,100.5);
  ctxt.stroke();

  var grades = {};
  var agrades = {};
  for (var i = 0; i < gds.length; i++) {
    grades[gds[i][0]] = 0;
    agrades[gds[i][3]] = 0;
  }

  for (var i = 0; i <= 100; i++) {
    if (i % 5 === 0) {
      ctxt.strokeStyle = "#000";
      ctxt.beginPath();
      ctxt.moveTo(5.5 + 5*i, 100.5);
      ctxt.lineTo(5.5 + 5*i, 100.5 + (i % 10 === 0 ? 5 : 3));
      ctxt.stroke();
      if (i % 10 === 0) {
        ctxt.fillStyle = "#000";
        ctxt.font = "12px sans-serif";
        ctxt.textAlign = "center";
        ctxt.fillText(''+i, 5.5 + 5*i, 100.5+5+13);
      }
    }
  }
  var c = 0;
  var ls = -1;
  for (var i = 0; i < rdata.length; i++) {
    var s = rdata[i];
    var rs = ~~s;
    if (rs > ls) {
      ls = rs; c = 0;
    }
    c++;
    for (var j = 0; j < gds.length; j++) {
      if (s >= window[gds[j][0]]) {
        grades[gds[j][0]]++;
        agrades[gds[j][3]]++;
        ctxt.fillStyle = gds[j][1];
        break;
      }
    }
    ctxt.beginPath()
    ctxt.arc(5.5 + 2+5*rs, 100.5 - 5*c, 2, 0, 2*Math.PI);
    ctxt.fill();
  }

  function dcount(n, cutoff1, cutoff2, offset) {
    n = '' + n;
    var w = ctxt.measureText(n).width;
    var mid = 5.5+5*(cutoff2+cutoff1)/2;
    ctxt.textAlign = "center";
    ctxt.fillText(n, mid, 15+offset);
  }
  ctxt.text = "12px sans-serif";
  ctxt.fillStyle = "#000";
  for (var i = 0; i < gds.length; i++) {
    var offset = 15;
    if (i === 0 || gds[i][3] != gds[i-1][3]) {
      var cutoff2 = 100;
      if (i !== 0) {
        cutoff2 = window[gds[i-1][0]];
      }
      var j = i;
      while (j+1 < gds.length && gds[j+1][3] === gds[i][3]) { j++; }
      if (j !== i) {
        dcount(agrades[gds[i][3]], window[gds[j][0]], cutoff2, 0);
      } else {
        offset = 0;
      }
    }

    var cutoff2 = 100;
    if (i !== 0) {
      cutoff2 = window[gds[i-1][0]];
    }
    dcount(grades[gds[i][0]], window[gds[i][0]], cutoff2, offset);
  }

  var gvars = document.querySelectorAll("[gvar]");
  for (var i = 0; i < gvars.length; i++) {
    var gcan = gvars[i];
    var gv = gcan.getAttribute('gvar');
    gcan.height = 12;
    gcan.width = 140;
    var gctxt = gvars[i].getContext("2d");
    gctxt.clearRect(0, 0, gcan.width, gcan.height);

    for (var j = 0; j < gds.length; j++) {
      if (gds[j][0] === gv) {
        gctxt.fillStyle = gds[j][1];
        break;
      }
    }

    var r = 0, c = 0;
    for (var j = 0; j < grades[gv]; j++) {
      gctxt.beginPath()
      gctxt.arc(2.5 + 5*c, 2.5 + 5*r, 2, 0, 2*Math.PI);
      gctxt.fill();
      r++; if (r === 2) { c++; r = 0; }
    }

    gctxt.text = "12px sans-serif";
    gctxt.textAlign = "right";
    gctxt.fillStyle = "#000";
    gctxt.fillText(''+grades[gv], gcan.width-3, gcan.height-3);
  }

  var outputtext = "";
  for (var i = 0; i < gds.length; i++) {
    outputtext += gds[i][4] + " >= " + window[gds[i][0]] + "\n";
  } console.log(outputtext);
  document.getElementById('output').value = outputtext;
}

function _addEventListener(obj, type, callback) {
  if (obj.addEventListener) {
    obj.addEventListener(type, callback, false);
  } else {
    obj.attachEvent('on' + type, callback);
  }
}

function clamp(v) {
  return v < 0 ? 0 : v > 100 ? 100 : v;
}

function update() {
    var jvars = document.querySelectorAll("[jvar]");
    for (var i = 0; i < jvars.length; i++) {
      if (!isNaN(+jvars[i].value)) {
        window[jvars[i].getAttribute('jvar')] = clamp(+jvars[i].value);
      }
      jvars[i].value = window[jvars[i].getAttribute('jvar')];
    }
    draw();
}

window.onload = function () {

  var jvars = document.querySelectorAll("[jvar]");
  for (var i = 0; i < jvars.length; i++) {
    jvars[i].value = window[jvars[i].getAttribute('jvar')];
    (function () {
      var jvar = jvars[i];
      _addEventListener(jvars[i], "keydown", function (e) {
        var d = 0;
        if (e.keyCode === 38) {
          d = 0.25;
        } else if (e.keyCode === 40) {
          d = -0.25;
        }
        if (d !== 0) {
          e.preventDefault();
          var v = window[jvar.getAttribute('jvar')] + d;
          jvar.value = clamp(v);
          update();
        }
      });
    })();
  }

  document.getElementById("update").onsubmit = function (e) {
    e.preventDefault();
    update();
    return false;
  };

  draw();
};

</script>
<style>
  td.gholder {
    padding: 0;
  }
</style>
</head>
<body>
<canvas id="graph" width="800" height="130"></canvas>

<br>
<br>
<form id="update">
<table>
<tr><th>A+ cutoff:</th><td><input type="text" jvar="cAp"></td><td class="gholder"><canvas gvar="cAp"></canvas></td>
<td rowspan=10 style="vertical-align:top"><p style="margin-left: 4em;">Copyable:</p><textarea tabindex="-1" style="margin:0 0 0 4em;padding: 0;height: 150px;" id="output"></textarea>
</tr>
<tr><th>A cutoff:</th><td><input type="text" jvar="cA"></td><td class="gholder"><canvas gvar="cA"></canvas></td></tr>
<tr><th>A- cutoff:</th><td><input type="text" jvar="cAm"></td><td class="gholder"><canvas gvar="cAm"></canvas></td></tr>
<tr><th>B+ cutoff:</th><td><input type="text" jvar="cBp"></td><td class="gholder"><canvas gvar="cBp"></canvas></td></tr>
<tr><th>B cutoff:</th><td><input type="text" jvar="cB"></td><td class="gholder"><canvas gvar="cB"></canvas></td></tr>
<tr><th>B- cutoff:</th><td><input type="text" jvar="cBm"></td><td class="gholder"><canvas gvar="cBm"></canvas></td></tr>
<tr><th>C+ cutoff:</th><td><input type="text" jvar="cCp"></td><td class="gholder"><canvas gvar="cCp"></canvas></td></tr>
<tr><th>C cutoff:</th><td><input type="text" jvar="cC"></td><td class="gholder"><canvas gvar="cC"></canvas></td></tr>
<tr><th>C- cutoff:</th><td><input type="text" jvar="cCm"></td><td class="gholder"><canvas gvar="cCm"></canvas></td></tr>
<tr><th>D+ cutoff:</th><td><input type="text" jvar="cDp"></td><td class="gholder"><canvas gvar="cDp"></canvas></td></tr>
<tr><th>D cutoff:</th><td><input type="text" jvar="cD"></td><td class="gholder"><canvas gvar="cD"></canvas></td></tr>
</table>
<input type="submit" value="Update"/> (up/down arrows increment/decrement)
</form>
<p><em>N</em> = 340<br>
<em>&mu;</em> = 64.7<br>
<em>&sigma;</em> = 16.4</p>

<p>Light gray is kernel density estimation.</p>
</body>
</html>
